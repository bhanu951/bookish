window.CKEditor5=window.CKEditor5||{},window.CKEditor5.bookishImage=function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){t.exports=CKEditor5.dll},function(t,e,i){t.exports=i(0)("./src/core.js")},function(t,e,i){t.exports=i(0)("./src/ui.js")},function(t,e,i){"use strict";i.r(e),i.d(e,"BookishImage",(function(){return a})),i.d(e,"icons",(function(){return s}));var o='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>',n=i(1),r=i(2);class a extends n.Plugin{static get pluginName(){return"BookishImage"}init(){const t=this.editor,e=t.t,i=t.model,{schema:n}=t.model;n.isRegistered("imageInline")&&n.extend("imageInline",{allowAttributes:["dataBookishImageStyle"]}),n.isRegistered("imageBlock")&&n.extend("imageBlock",{allowAttributes:["dataBookishImageStyle"]}),t.conversion.for("upcast").add(t=>{t.on("element:img",(t,e,i)=>{const{viewItem:o}=e,{writer:n}=i,r=o.getAttribute("data-bookish-image-style"),a=o.getAttribute("data-entity-uuid");if(r&&a)for(const t of e.modelRange){const{item:e}=t;"imageInline"!==e.name&&"imageBlock"!==e.name||e.getAttribute("dataEntityUuid")!==a||n.setAttribute("dataBookishImageStyle",r,e)}})}),t.conversion.for("downcast").add(t=>{t.on("attribute:dataBookishImageStyle",(t,e,i)=>{const{item:o}=e,{consumable:n,writer:r}=i;if(!n.consume(o,t.name))return;const a=i.mapper.toViewElement(o),s=Array.from(a.getChildren()).find(t=>"img"===t.name);null!==e.attributeNewValue?r.setAttribute("data-bookish-image-style",e.attributeNewValue,s||a):r.removeAttribute("data-bookish-image-style",img,s||a)})}),t.ui.componentFactory.add("bookishImageButton",t=>{const n=new r.ButtonView(t);return n.set({label:e("Edit image"),icon:o,tooltip:!0,isToggleable:!0}),this.listenTo(n,"execute",()=>{const t=i.document.selection,e=t.getSelectedElement()||first(t.getSelectedBlocks()),o=e.getAttribute("dataEntityUuid"),n=e.getAttribute("dataEntityType");if(!n||"file"!=n||!o)return;const r={url:drupalSettings.path.baseUrl+drupalSettings.path.pathPrefix+`admin/bookish-image-effect-form/${o}?imageStyle=${e.getAttribute("dataBookishImageStyle")}`,event:"click",dialogType:"modal",dialog:{width:1280,height:850},progress:{type:"none"}};Drupal.ajax(r).execute(),window.bookishImageAjaxCallback=function(t,o){i.change(i=>{const n=new URL(t);n.searchParams.set("t",(new Date).getTime()),i.setAttribute("src",n.toString(),e),i.setAttribute("dataBookishImageStyle",o,e)})}}),n})}}const s={ckeditor:o}}]);