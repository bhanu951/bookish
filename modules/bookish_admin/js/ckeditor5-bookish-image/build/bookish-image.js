window.CKEditor5=window.CKEditor5||{},window.CKEditor5.bookishImage=function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t){e.exports=CKEditor5.dll},function(e,t,o){e.exports=o(0)("./src/core.js")},function(e,t,o){e.exports=o(0)("./src/ui.js")},function(e,t,o){"use strict";o.r(t),o.d(t,"BookishImage",(function(){return a})),o.d(t,"icons",(function(){return s}));var i='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>',n=o(1),r=o(2);class a extends n.Plugin{static get pluginName(){return"BookishImage"}init(){const e=this.editor,t=e.t,o=e.model,{schema:n}=e.model;n.isRegistered("imageInline")&&n.extend("imageInline",{allowAttributes:["dataBookishImageStyle"]}),n.isRegistered("imageBlock")&&n.extend("imageBlock",{allowAttributes:["dataBookishImageStyle"]}),e.conversion.for("upcast").attributeToAttribute({view:"data-bookish-image-style",model:"dataBookishImageStyle"}),e.conversion.for("downcast").add(e=>{e.on("attribute:dataBookishImageStyle",(e,t,o)=>{const{item:i}=t,{consumable:n,writer:r}=o;if(!n.consume(i,e.name))return;const a=o.mapper.toViewElement(i),s=Array.from(a.getChildren()).find(e=>"img"===e.name);null!==t.attributeNewValue?r.setAttribute("data-bookish-image-style",t.attributeNewValue,s||a):r.removeAttribute("data-bookish-image-style",img,s||a)})}),e.ui.componentFactory.add("bookishImageButton",e=>{const n=new r.ButtonView(e);return n.set({label:t("Edit image"),icon:i,tooltip:!0,isToggleable:!0}),this.listenTo(n,"execute",()=>{const e=o.document.selection,t=e.getSelectedElement()||first(e.getSelectedBlocks()),i=t.getAttribute("src"),n=t.getAttribute("dataEntityUuid"),r=t.getAttribute("dataEntityType");if(!i||!r||"file"!=r||!n)return;const a={url:drupalSettings.path.baseUrl+drupalSettings.path.pathPrefix+`admin/bookish-image-effect-form/${n}?fileUrl=${encodeURIComponent(i)}`,event:"click",dialogType:"modal",dialog:{width:1280,height:850},progress:{type:"none"}};Drupal.ajax(a).execute(),window.bookishImageAjaxCallback=function(e,i){o.change(o=>{const n=new URL(e);n.searchParams.set("t",(new Date).getTime()),o.setAttribute("src",n.toString(),t),o.setAttribute("dataBookishImageStyle",i,t)})}}),n})}}const s={ckeditor:i}}]);